<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CF Ladder — Paginated</title>
<style>
:root{--primary:#0d6efd;--muted:#6c757d}
body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#f5f7fb;margin:0;padding:20px}
.container{max-width:1200px;margin:0 auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(15,15,15,0.06)}
h1{margin:0 0 14px;font-size:22px;text-align:center;color:#111}
.controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin-bottom:12px}
.controls input, .controls select, .controls button {padding:8px 10px;font-size:14px}
.indices {display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.indices label{font-weight:600}
.table-wrap{overflow:auto}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;vertical-align:top;white-space:nowrap}
th{background:var(--primary);color:#fff;position:sticky;top:0}
tr:nth-child(even){background:#fbfcff}
.tag{display:inline-block;background:#eef2ff;padding:3px 8px;border-radius:999px;margin:2px 4px;font-size:12px;color:#0b3d91}
.small{font-size:13px;color:var(--muted)}
.pager {display:flex;gap:8px;align-items:center;justify-content:center;margin-top:10px}
.pager input[type="number"]{width:70px;padding:6px}
.info{margin-top:6px;text-align:center;color:var(--muted)}
.button-row{display:flex;gap:8px;align-items:center}
.credit {margin-top: 20px; text-align: center; color: var(--muted); font-size: 14px;}

/* ✅ Highlight solved problems */
tr.solved td {
  background: #e6ffe6;   /* light green background */
  color: #444;
}
</style>
</head>
<body>
<div class="container">
  <h1>Codeforces Ladder — Paginated (A–H)</h1>

  <div class="controls">
    <input id="handle" placeholder="CF handle (optional)">
    <input id="minRating" type="number" value="800" style="width:90px" title="Min rating">
    <input id="maxRating" type="number" value="3500" style="width:90px" title="Max rating">
    <select id="sortKey">
      <option value="solved">Most solved</option>
      <option value="rating">Rating</option>
      <option value="newest">Newest</option>
      <option value="oldest">Oldest</option>
    </select>

    <div class="indices" title="Pick indices">
      <label><input type="checkbox" name="idx" value="A" checked> A</label>
      <label><input type="checkbox" name="idx" value="B" checked> B</label>
      <label><input type="checkbox" name="idx" value="C" checked> C</label>
      <label><input type="checkbox" name="idx" value="D" checked> D</label>
      <label><input type="checkbox" name="idx" value="E" checked> E</label>
      <label><input type="checkbox" name="idx" value="F" checked> F</label>
      <label><input type="checkbox" name="idx" value="G"> G</label>
      <label><input type="checkbox" name="idx" value="H"> H</label>
    </div>

    <div class="button-row">
      <button id="apply">Apply</button>
      <button id="onlyA" title="Select only A">Only A</button>
      <button id="onlyB" title="Select only B">Only B</button>
      <button id="random" title="Open random problem">Random</button>
      <button id="export" title="Export all filtered as CSV">Export CSV</button>
    </div>
  </div>

  <div id="info" class="info">Loading...</div>

  <div class="table-wrap">
    <table id="ladder">
      <thead>
        <tr>
          <th>#</th><th>Problem</th><th>Contest</th><th>Division</th>
          <th>Rating</th><th>Solved</th><th>Tags</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="pager">
    <button id="prev">Prev</button>
    <span>Page</span>
    <input id="pageInput" type="number" min="1" value="1">
    <span>/ <span id="pageCount">1</span></span>
    <button id="next">Next</button>
    <label style="margin-left:12px">Per page:
      <select id="pageSize"><option>10</option><option>25</option><option>50</option><option>100</option></select>
    </label>
  </div>
  
  <div class="credit">Made by Samia5038</div>
</div>

<script>
/*const API_BASE = "http://127.0.0.1:5000/api/ladder";*/
const API_BASE = "https://cf-ladder-d1hd.onrender.com/api/ladder";

let fullData = [];
let currentPage = 1;
let pageSize = 25;

function getSelectedIndices(){ 
  return Array.from(document.querySelectorAll('input[name="idx"]:checked')).map(n=>n.value); 
}
function setOnly(index){ 
  document.querySelectorAll('input[name="idx"]').forEach(cb => cb.checked = false); 
  const el = document.querySelector(`input[name="idx"][value="${index}"]`); 
  if(el) el.checked = true; 
}

async function load(){
  const handle = document.getElementById('handle').value.trim();
  const min = document.getElementById('minRating').value || 800;
  const max = document.getElementById('maxRating').value || 3500;
  const sort = document.getElementById('sortKey').value;
  const indices = getSelectedIndices().join(',');
  document.getElementById('info').textContent = 'Loading...';
  try{
    const url = `${API_BASE}?handle=${encodeURIComponent(handle)}&min=${min}&max=${max}&sort=${sort}&indices=${encodeURIComponent(indices)}`;
    const res = await fetch(url);
    const data = await res.json();
    if(data.error){ 
      document.getElementById('info').textContent = 'Error: '+data.error; 
      fullData=[]; renderPage(); 
      return; 
    }
    fullData = data;
    currentPage = 1;
    pageSize = parseInt(document.getElementById('pageSize').value,10);
    renderPage();
    document.getElementById('info').textContent = `Total: ${fullData.length} problems (filters applied)`;
  }catch(e){
    document.getElementById('info').textContent = 'Failed to fetch — make sure backend is running.';
    console.error(e);
    fullData = [];
    renderPage();
  }
}

function renderPage(){
  const tbody = document.querySelector('#ladder tbody');
  tbody.innerHTML = '';
  const total = fullData.length;
  pageSize = parseInt(document.getElementById('pageSize').value,10) || 25;
  const pageCount = Math.max(1, Math.ceil(total / pageSize));
  if(currentPage > pageCount) currentPage = pageCount;
  document.getElementById('pageCount').textContent = pageCount;
  document.getElementById('pageInput').value = currentPage;

  if(total === 0){
    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center">No problems</td></tr>';
    return;
  }
  const start = (currentPage-1)*pageSize;
  const end = Math.min(total, start + pageSize);
  for(let i=start;i<end;i++){
    const p = fullData[i];
    const tags = (p.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join(' ');
    const tr = document.createElement('tr');
    if (p.solved) tr.classList.add('solved');   // ✅ mark solved
    tr.innerHTML = `<td>${i+1}</td>
      <td><a href="${p.link}" target="_blank">${p.index} — ${escapeHtml(p.name)}</a></td>
      <td class="small">${escapeHtml(p.contestName)}</td>
      <td>${escapeHtml(p.division)}</td>
      <td>${p.rating}</td>
      <td>${p.solvedCount}</td>
      <td>${tags}</td>`;
    tbody.appendChild(tr);
  }
}

function escapeHtml(s){ 
  return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); 
}

// events
document.getElementById('apply').addEventListener('click', load);
document.getElementById('onlyA').addEventListener('click', ()=>{ setOnly('A'); load(); });
document.getElementById('onlyB').addEventListener('click', ()=>{ setOnly('B'); load(); });

document.getElementById('pageSize').addEventListener('change', ()=>{ currentPage=1; renderPage(); });
document.getElementById('prev').addEventListener('click', ()=>{ if(currentPage>1){ currentPage--; renderPage(); }});
document.getElementById('next').addEventListener('click', ()=>{ const maxp = Math.max(1, Math.ceil(fullData.length / pageSize)); if(currentPage<maxp){ currentPage++; renderPage(); }});
document.getElementById('pageInput').addEventListener('change', (e)=>{ 
  let v=parseInt(e.target.value||1,10); 
  const maxp = Math.max(1, Math.ceil(fullData.length / pageSize)); 
  if(isNaN(v)||v<1) v=1; 
  if(v>maxp) v=maxp; 
  currentPage=v; 
  renderPage(); 
});

document.getElementById('random').addEventListener('click', ()=>{
  if(!fullData.length){ alert('No problems to pick from'); return; }
  const pick = fullData[Math.floor(Math.random()*fullData.length)];
  window.open(pick.link, '_blank');
});

document.getElementById('export').addEventListener('click', ()=>{
  if(!fullData.length){ alert('Nothing to export'); return; }
  const csv = ['#","contestId","index","name","contestName","rating","solvedCount","tags","division","link'];
  fullData.forEach((p,i)=>{
    const tags = (p.tags||[]).join(';').replace(/"/g,'""');
    const name = (p.name||'').replace(/"/g,'""');
    const contestName = (p.contestName||'').replace(/"/g,'""');
    csv.push([i+1,p.contestId,p.index,`"${name}"`,`"${contestName}"`,p.rating,p.solvedCount,`"${tags}"`,p.division,p.link].join(','));
  });
  const blob = new Blob([csv.join('\n')], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); 
  a.href=url; 
  a.download='ladder_export.csv'; 
  a.click(); 
  URL.revokeObjectURL(url);
});

// initial load
load();
</script>
</body>
</html>